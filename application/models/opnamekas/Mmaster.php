<?phpdefined('BASEPATH') OR exit('No direct script access allowed');use Ozdemir\Datatables\Datatables;use Ozdemir\Datatables\DB\CodeigniterAdapter;class Mmaster extends CI_Model {    public function cekoptoday(){        $ada   = 'ada';        $today = date('Y-m-d');        $this->db->select('count(i_opname) AS i_opname');        $this->db->from('tm_opname_kas');        $this->db->where('d_opname', $today);        return $this->db->get();     }    public function data($folder){        $datatables = new Datatables(new CodeigniterAdapter);        $datatables->query("            SELECT                i_opname,                TO_CHAR(d_opname, 'dd-mm-yyyy') AS d_opname,                i_area,                '$folder' AS folder            FROM                tm_opname_kas            WHERE                i_area = '00'            ORDER BY                d_opname DESC        ", FALSE);        $datatables->add('action', function ($data) {            $iopname = trim($data['i_opname']);            $folder  = $data['folder'];            $data    = '';            $data   .= "<a href='#' onclick='detail(\"$iopname\"); return false;'><i class='fa fa-print'></i></a>";            return $data;        });        $datatables->hide('folder');        return $datatables->generate();    }    public function bacabank(){        $this->db->select('*');        $this->db->from('tr_bank');        $query = $this->db->get();        if ($query->num_rows() > 0){            return $query->result();        }    }    public function company($idcompany){        $this->db->select('name');        $this->db->from('public.company');        $this->db->where('id', $idcompany);        return $this->db->get();    }    public function runningnumber($thbl){        $th     = substr($thbl,0,4);        $asal   = substr($thbl,2,2).substr($thbl,5,2);        $periode= substr($thbl,0,4).substr($thbl,5,2);        $this->db->select("                n_modul_no AS MAX            FROM                tm_dgu_no            WHERE                i_modul = 'OK'                AND substr(e_periode,                1,                4)= '$th'                AND i_area = '00' FOR            UPDATE        ", false);        $query = $this->db->get();        if ($query->num_rows() > 0){            foreach($query->result() as $row){                $terakhir=$row->max;            }            $nook = $terakhir+1;                        $this->db->query("                 UPDATE                    tm_dgu_no                SET                    n_modul_no = $nook                WHERE                    i_modul = 'OK'                    AND substr(e_periode,                    1,                    4)= '$th'                    AND i_area = '00'            ", false);            settype($nook,"string");            $a=strlen($nook);            while($a<6){                $nook="0".$nook;                $a=strlen($nook);            }            $nook  ="OK-".$asal."-".$nook;            return $nook;        }else{            $nook  ="000001";            $nook  ="OK-".$asal."-".$nook;            $this->db->query("                INSERT                    INTO                    tm_dgu_no(i_modul,                    i_area,                    e_periode,                    n_modul_no)                VALUES ('OK',                '00',                $periode,                1)            ");            return $nook;        }    }    public function opnamebank($rm, $thbl,$icoa,$nama, $saldobank, $dfrombank){        $this->db->set(            array (                 'i_opname'      => $rm,                'i_coa_bank'    => $icoa,                'd_opname'      => $thbl,                'n_saldo'       => $saldobank,                'e_coa_name'    => $nama,                'd_bank'        => $dfrombank            )        );        $this->db->insert('tm_opname_bank');    }    public function opnamekas($rm, $thbl,$totaldanaharus,$txtket, $iarea, $totalnota, $dfrom1, $dto1, $totalkasbon, $dfrom2, $dto2, $totalatm, $totallain){        $now = '';        $now = current_datetime();        $this->db->set(            array(                'i_opname'              => $rm,                'd_opname'              => $thbl,                'd_entry'               => $now,                'n_dana_seharusnya'     => $totaldanaharus,                'e_description'         => $txtket,                'i_area'                => $iarea,                'n_nota_biaya'          => $totalnota,                'd_nota_biayafrom'      => $dfrom1,                'd_nota_biayato'        => $dto1,                'n_kasbon_gantung'      => $totalkasbon,                'd_kasbon_gantungfrom'  => $dfrom2,                'd_kasbon_gantungto'    => $dto2,                'v_saldo_atm'           => $totalatm,                'v_saldo_lain'          => $totallain            )        );        $this->db->insert('tm_opname_kas');    }    public function opnamekasdetail($rm, $txtkertas100000,$txtkertas50000,$txtkertas20000,$txtkertas10000,$txtkertas5000,$txtkertas2000,$txtkertas1000,$txtkertas500,$totalkertas100000,$totalkertas50000,$totalkertas20000,$totalkertas10000,$totalkertas5000,$totalkertas2000,$totalkertas1000,$totalkertas500,$txtlogam1000,$txtlogam500,$txtlogam200,$txtlogam100,$txtlogam50,$totallogam1000,$totallogam500,$totallogam200,$totallogam100,$totallogam50){        $this->db->set(            array(                  'i_opname'           => $rm,               'n_kertas_100000'    => $txtkertas100000,               'n_kertas_50000'     => $txtkertas50000,               'n_kertas_20000'     => $txtkertas20000,               'n_kertas_10000'     => $txtkertas10000,               'n_kertas_5000'      => $txtkertas5000,               'n_kertas_2000'      => $txtkertas2000,               'n_kertas_1000'      => $txtkertas1000,               'n_kertas_500'       => $txtkertas500,               'n_logam_1000'       => $txtlogam1000,               'n_logam_500'        => $txtlogam500,               'n_logam_200'        => $txtlogam200,               'n_logam_100'        => $txtlogam100,               'n_logam_50'         => $txtlogam50,               'v_kertas_100000'    => $totalkertas100000,               'v_kertas_50000'     => $totalkertas50000,               'v_kertas_20000'     => $totalkertas20000,               'v_kertas_10000'     => $totalkertas10000,               'v_kertas_5000'      => $totalkertas5000,               'v_kertas_2000'      => $totalkertas2000,               'v_kertas_1000'      => $totalkertas1000,               'v_kertas_500'       => $totalkertas500,               'v_logam_1000'       => $totallogam1000,               'v_logam_500'        => $totallogam500,               'v_logam_200'        => $totallogam200,               'v_logam_100'        => $totallogam100,               'v_logam_50'         => $totallogam50           )        );        $this->db->insert('tm_opname_kasdetail');    }    public function opkas($i_opname){        $this->db->select(" * from tm_opname_kas where i_opname = '$i_opname'", false);        $query = $this->db->get();        if ($query->num_rows() > 0){            return $query->result();        }    }    public function opbank($i_opname){        $this->db->select(" * from tm_opname_bank where i_opname = '$i_opname'", false);        $query = $this->db->get();        if ($query->num_rows() > 0){            return $query->result();        }    }    public function opdetail($i_opname){        $this->db->select(" * from tm_opname_kasdetail where i_opname = '$i_opname' ", false);        $query = $this->db->get();        if ($query->num_rows() > 0){            return $query->result();        }    }}/* End of file Mmaster.php */